<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Catálogo de Beats Oficial | MONTEKING MX</title>

<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Catálogo Oficial | MONTEKING MX</title>

<meta property="og:type" content="website">
<meta property="og:url" content="https://montekingmx.github.io/">
<meta property="og:title" content="Catálogo de Beats Oficial | MONTEKING MX">
<meta property="og:description" content="Beats Premium Disponibles | Licencias Exclusivas | Escucha y compra aquí.">
<meta property="og:image" content="https://montekingmx.github.io/assets/preview.jpg">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Catálogo de Beats Oficial | MONTEKING MX">
<meta name="twitter:description" content="Beats Premium Disponibles.">
<meta name="twitter:image" content="https://montekingmx.github.io/assets/preview.jpg">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-STKXJ58C44"></script>
...

<script async src="https://www.googletagmanager.com/gtag/js?id=G-STKXJ58C44"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-STKXJ58C44');
</script>

<script src="https://www.paypal.com/sdk/js?client-id=sb&currency=MXN"></script>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Oswald:wght@300;500;700&family=Pirata+One&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/amplitudejs@5.3.2/dist/amplitude.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vanilla-tilt@1.8.1/dist/vanilla-tilt.min.js"></script>

<style>
/* --- VARIABLES --- */
:root {
    --theme-primary: #FFD700;
    --theme-glow: rgba(255, 215, 0, 0.6); 
    --theme-bg-tint: rgba(20, 20, 0, 0.5); 
    --glass-black: rgba(0, 0, 0, 0.9);
}
* { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color: transparent; outline: none; }
body {
    background: #050505; color: #fff; font-family: 'Oswald', sans-serif;
    overflow-x: hidden; padding-bottom: 150px;
    user-select: none;
}

/* CURSOR (Solo PC) */
@media (hover: hover) and (pointer: fine) {
    body { cursor: none; }
    .cursor {
        position: fixed; top: 0; left: 0; width: 12px; height: 12px;
        background: #fff; border-radius: 50%; pointer-events: none; z-index: 9999;
        box-shadow: 0 0 10px #fff; transform: translate(-50%, -50%); mix-blend-mode: difference;
    }
}

/* --- BACKGROUND FX --- */
.bg-fixed { position: fixed; inset: 0; z-index: -10; pointer-events: none; }
.bg-texture { position: absolute; inset: -10%; background: url('assets/crocodile_texture.jpg') center/cover; opacity: 0.6; filter: brightness(0.4); }
.bg-tint { position: absolute; inset: 0; background: var(--theme-bg-tint); mix-blend-mode: overlay; transition: background 0.5s; }
.bg-smoke { position: absolute; inset: 0; background: url('https://raw.githubusercontent.com/SochavaAG/example-assets/master/fog1.png') repeat-x; background-size: 200% 100%; opacity: 0.3; animation: smoke 60s linear infinite; }
#particles-js { position: absolute; inset: 0; pointer-events: none; z-index: -5; }
.sparkle { position: absolute; background: var(--theme-primary); border-radius: 50%; box-shadow: 0 0 10px var(--theme-primary); opacity: 0; }
@keyframes smoke { 0%{background-position:0 0} 100%{background-position:-200% 0} }

/* --- HEADER --- */
header { position: relative; padding: 15px; text-align: center; z-index: 10; }
.top-bar {
    display: flex; justify-content: space-between; align-items: center;
    padding: 0 5%; width: 100%; position: relative; z-index: 20;
}
.social-icons a { color: #fff; font-size: 1.6rem; margin: 0 10px; transition: 0.3s; }
.social-icons a:hover { color: var(--theme-primary); text-shadow: 0 0 15px var(--theme-primary); transform: scale(1.2); }
.logos-container img { height: 70px; transition: 0.3s; }

.hanging-sign {
    display: inline-block; margin-top: 50px; position: relative;
    transform-origin: top center; animation: swing 5s ease-in-out infinite;
}
.chain {
    position: absolute; top: -100px; width: 6px; height: 120px;
    background: repeating-linear-gradient(to bottom, #8a6e0e, #ffd700 5px, #443707 10px);
    border: 1px solid #000; z-index: -1;
}
.c-left { left: 10px; transform: rotate(15deg); }
.c-right { right: 10px; transform: rotate(-15deg); }

.main-title {
    font-family: 'Pirata One', cursive; font-size: clamp(3.5rem, 10vw, 7rem);
    line-height: 0.9; color: transparent; -webkit-text-stroke: 1.5px var(--theme-primary);
    background: linear-gradient(180deg, #fff 0%, #777 100%);
    -webkit-background-clip: text; background-clip: text;
    filter: drop-shadow(0 0 25px var(--theme-glow)); transition: 0.5s;
}
.subtitle { font-size: clamp(0.8rem, 2vw, 1.2rem); letter-spacing: 0.5em; color: var(--theme-primary); text-transform: uppercase; margin-top: 10px; }
@keyframes swing { 0%,100%{transform:rotate(1deg)} 50%{transform:rotate(-1deg)} }

/* --- LICENSES --- */
#licenses {
    width: 95%; max-width: 1000px; margin: 30px auto;
    background: var(--glass-black); border: 2px solid var(--theme-primary);
    box-shadow: 0 0 30px var(--theme-glow); padding: 25px;
    backdrop-filter: blur(10px);
}
#licenses h2 { font-family: 'Pirata One'; font-size: 2.5rem; text-align: center; color: var(--theme-primary); margin-bottom: 20px; }
.license-item { border-bottom: 1px solid #333; padding-bottom: 15px; margin-bottom: 15px; }
.lic-head { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; }
.lic-head b { font-size: 1.2rem; color: #fff; }
.price-tag { font-family: 'Pirata One'; font-size: 1.8rem; color: var(--theme-primary); }
.signature { display: block; width: 180px; margin: 20px auto 0; filter: drop-shadow(0 0 0 var(--theme-primary)); opacity: 0.9; }

/* --- FILTERS --- */
.filters-wrapper {
    overflow-x: auto; white-space: nowrap; padding: 10px 5%;
    -webkit-overflow-scrolling: touch; margin-bottom: 20px;
}
.filters-wrapper::-webkit-scrollbar { display: none; }
.filters { display: inline-flex; gap: 10px; }
.filter-btn {
    background: rgba(20,20,20,0.9); border: 1px solid #555; color: #fff;
    padding: 10px 20px; font-family: 'Oswald'; font-size: 1rem; text-transform: uppercase;
    cursor: pointer; transition: 0.3s;
}
.filter-btn.active { background: var(--theme-primary); color: #000; font-weight: bold; border-color: var(--theme-primary); }

/* --- GRID SYSTEM --- */
.grid {
    display: grid;
    gap: 20px; padding: 0 5%; max-width: 1600px; margin: 0 auto;
    grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
}
/* TABLET */
@media (min-width: 601px) and (max-width: 1024px) {
    .grid { grid-template-columns: repeat(3, 1fr); gap: 15px; }
}
/* MOVIL */
@media (max-width: 600px) {
    .grid { grid-template-columns: repeat(2, 1fr); gap: 10px; padding: 0 10px; }
    .card { height: 240px !important; }
    .card-title { font-size: 1.1rem !important; } 
    .card-bpm { font-size: 0.7rem !important; }
    .card-play-btn { width: 35px !important; height: 35px !important; font-size: 1rem !important; }
    .card-add-btn { width: 30px !important; height: 30px !important; font-size: 0.9rem !important; }
}

.card {
    position: relative; height: 380px; background: #000;
    border: 1px solid #333; border-radius: 6px; overflow: hidden;
    transition: 0.3s; cursor: pointer;
}
.card.playing { border-color: var(--theme-primary); box-shadow: 0 0 15px var(--theme-primary); }
.card:hover { transform: translateY(-5px); border-color: var(--theme-primary); }

.card-bg { width: 100%; height: 100%; object-fit: cover; opacity: 0.6; transition: 0.5s; }
.card:hover .card-bg { transform: scale(1.1); opacity: 0.4; }

.card-overlay {
    position: absolute; bottom: 0; left: 0; width: 100%;
    background: linear-gradient(to top, #000 60%, transparent);
    padding: 12px; display: flex; flex-direction: column; gap: 4px;
}
.card-title {
    font-family: 'Pirata One'; font-size: 1.6rem; color: transparent;
    -webkit-text-stroke: 0.5px var(--theme-primary);
    white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
}
.card-controls { display: flex; justify-content: space-between; align-items: center; }
.card-bpm { color: var(--theme-primary); font-size: 0.9rem; }

.card-actions { display: flex; gap: 8px; align-items: center; }
.card-play-btn {
    width: 45px; height: 45px; border-radius: 50%;
    border: 2px solid var(--theme-primary); color: var(--theme-primary);
    display: grid; place-items: center; font-size: 1.2rem;
    background: rgba(0,0,0,0.6); transition: 0.2s; z-index: 5;
}
.card-add-btn {
    width: 35px; height: 35px; border-radius: 5px;
    background: var(--theme-primary); color: #000;
    display: grid; place-items: center; font-size: 1rem;
    transition: 0.2s; z-index: 5;
}
.card-play-btn:active, .card-add-btn:active { transform: scale(0.9); }

/* --- CART FLOAT --- */
.cart-float {
    position: fixed; bottom: 160px; right: 20px;
    background: #000; border: 2px solid var(--theme-primary);
    width: 55px; height: 55px; border-radius: 50%;
    display: none; align-items: center; justify-content: center;
    color: var(--theme-primary); font-size: 1.4rem; cursor: pointer; z-index: 2000;
    box-shadow: 0 0 20px var(--theme-glow);
}

/* --- MODAL --- */
.modal-overlay {
    display: none; position: fixed; inset: 0; z-index: 5000;
    background: rgba(0,0,0,0.95); backdrop-filter: blur(5px);
    align-items: center; justify-content: center; padding: 10px;
}
.modal-box {
    background: #111; border: 1px solid var(--theme-primary);
    width: 100%; max-width: 900px; max-height: 90vh; overflow-y: auto;
    display: flex; flex-wrap: wrap; position: relative;
    box-shadow: 0 0 40px var(--theme-glow);
}
.close-modal { position: absolute; top: 10px; right: 15px; color: #fff; font-size: 2rem; cursor: pointer; z-index: 10; }

.modal-left { width: 40%; min-width: 300px; padding: 20px; background: #080808; border-right: 1px solid #333; display: flex; flex-direction: column; align-items: center; text-align: center; }
.modal-cover { width: 100%; max-width: 250px; aspect-ratio: 1/1; object-fit: cover; border: 1px solid #333; margin-bottom: 20px; }
.modal-right { flex: 1; padding: 20px; min-width: 300px; }

.checkout-tabs { display: flex; border-bottom: 1px solid #333; margin-bottom: 20px; }
.tab-btn {
    flex: 1; background: none; border: none; color: #888; padding: 12px;
    font-family: 'Oswald'; text-transform: uppercase; cursor: pointer; border-bottom: 2px solid transparent;
}
.tab-btn.active { color: var(--theme-primary); border-color: var(--theme-primary); font-weight: bold; }
.tab-content { display: none; animation: fadeIn 0.3s; }
.tab-content.active { display: block; }
@keyframes fadeIn { from{opacity:0}to{opacity:1}}

.pay-btn {
    width: 100%; padding: 15px; margin: 10px 0; border: none; border-radius: 4px;
    font-weight: bold; font-size: 1.1rem; cursor: pointer; text-transform: uppercase;
    display: flex; align-items: center; justify-content: center; gap: 10px;
}
.pay-wa { background: #25D366; color: #fff; }

/* --- PLAYER FOOTER --- */
footer {
    position: fixed; bottom: 0; left: 0; width: 100%; z-index: 1000;
    background: rgba(5,5,5,0.98); border-top: 3px solid var(--theme-primary);
    padding: 10px 20px;
    display: grid; grid-template-columns: 2fr 3fr 2fr; align-items: center;
    box-shadow: 0 -5px 30px rgba(0,0,0,0.8);
}
@media (max-width: 768px) {
    footer { display: flex; flex-direction: column; height: 135px; padding: 15px 10px; gap: 8px; }
    .player-right { display: none !important; }
    .player-info { width: 100%; text-align: center; }
}
#viz-canvas { position: absolute; bottom: 0; left: 0; width: 100%; height: 100%; opacity: 0.2; pointer-events: none; z-index: -1; }

.current-title { font-family: 'Pirata One'; font-size: 1.3rem; color: var(--theme-primary); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; display: block; max-width: 100%; }
.current-artist { font-size: 0.8rem; color: #888; }

/* CONTROLS (HIGH PRIORITY Z-INDEX) */
.player-controls { 
    display: flex; flex-direction: column; align-items: center; gap: 5px; 
    position: relative; z-index: 9999; /* Asegura clic en movil */
}
.btns { display: flex; gap: 25px; align-items: center; font-size: 1.6rem; }
.btns i { cursor: pointer; color: #fff; padding: 5px; } /* Padding aumenta area de toque */
.play-main { font-size: 2.8rem !important; }
.prog-bar { width: 100%; display: flex; align-items: center; gap: 10px; font-size: 0.8rem; color: var(--theme-primary); }
input[type=range] { width: 100%; accent-color: var(--theme-primary); cursor: pointer; height: 20px; /* Mas facil de agarrar */ }
.player-right { display: flex; justify-content: flex-end; align-items: center; gap: 10px; }

</style>
</head>
<body>

<div class="bg-fixed">
    <div class="bg-texture"></div>
    <div class="bg-tint"></div>
    <div class="bg-smoke"></div>
    <div id="particles-js"></div>
</div>
<div class="cursor"></div>

<header>
    <div class="top-bar">
        <div class="social-icons">
            <a href="https://instagram.com/casilaog" target="_blank"><i class="fab fa-instagram"></i></a>
            <a href="https://youtube.com/@montekingmx" target="_blank"><i class="fab fa-youtube"></i></a>
        </div>
        <div class="logos-container">
            <img src="assets/logo_1.png" alt="Logo">
        </div>
    </div>
    
    <div class="hanging-sign">
        <div class="chain c-left"></div>
        <div class="chain c-right"></div>
        <h1 class="main-title">MONTEKING MX</h1>
        <div class="subtitle">PREMIUM BEAT CATALOG</div>
    </div>
</header>

<section id="licenses">
    <h2>LICENCIAS & PRECIOS</h2>
    <div class="license-item">
        <div class="lic-head"><b>1. Licencia Estándar (WAV)</b> <span class="price-tag">$500 MXN</span></div>
        <p>WAV Masterizado. Uso comercial no exclusivo.</p>
    </div>
    <div class="license-item">
        <div class="lic-head"><b>2. Licencia Pro (Stems)</b> <span class="price-tag">$700 MXN</span></div>
        <p>Trackout (Pistas separadas) + WAV + MP3.</p>
    </div>
    <div class="license-item">
        <div class="lic-head"><b>3. Exclusiva</b> <span class="price-tag">$1000 MXN*</span></div>
        <p>Archivos completos. El beat se elimina. *Precio base o % regalías.</p>
    </div>
    <img src="assets/signature.png" class="signature" alt="Represent.">
</section>

<div class="filters-wrapper">
    <div class="filters">
        <button class="filter-btn active" onclick="setTheme('ALL',this)">ALL</button>
        <button class="filter-btn" onclick="setTheme('TRAP-MEMPH',this)">TRAP MEMPHIS</button>
        <button class="filter-btn" onclick="setTheme('BOOMBAP',this)">BOOMBAP</button>
        <button class="filter-btn" onclick="setTheme('TECHNO',this)">TECHNO</button>
        <button class="filter-btn" onclick="setTheme('SUAVE',this)">R&B SUAVE</button>
    </div>
</div>

<div class="grid" id="grid"></div>

<div class="cart-float" id="cart-btn" onclick="openModal(lastClickedIndex || 0)">
    <i class="fas fa-shopping-cart"></i>
</div>

<div class="modal-overlay" id="modal">
    <div class="modal-box">
        <span class="close-modal" onclick="closeModal()">&times;</span>
        
        <div class="modal-left">
            <img src="" class="modal-cover" id="m-img">
            <h2 style="font-family:'Pirata One'; color:var(--theme-primary); font-size:2rem; line-height:1" id="m-title">Beat Title</h2>
            <p style="color:#888; margin-top:10px" id="m-meta">BPM | Genre</p>
        </div>

        <div class="modal-right">
            <label style="display:block; margin-bottom:10px; color:#aaa">SELECCIONA LICENCIA:</label>
            <select id="m-license" style="width:100%; padding:12px; background:#222; color:#fff; border:1px solid #555; font-size:1rem; margin-bottom:20px;" onchange="updateTotal()">
                <option value="500">Licencia Estándar ($500 MXN)</option>
                <option value="700">Licencia Pro Stems ($700 MXN)</option>
                <option value="1000">Exclusiva ($1000 MXN)</option>
            </select>

            <div class="checkout-tabs">
                <button class="tab-btn active" onclick="switchTab('tab-wa', event)">WhatsApp</button>
                <button class="tab-btn" onclick="switchTab('tab-card', event)">PayPal / Tarjeta</button>
                <button class="tab-btn" onclick="switchTab('tab-bank', event)">Transferencia</button>
            </div>

            <div id="tab-wa" class="tab-content active">
                <p style="color:#ccc; font-size:0.9rem; margin-bottom:15px">Habla directamente conmigo para cerrar el trato.</p>
                <button class="pay-btn pay-wa" onclick="sendWhatsApp()">
                    <i class="fab fa-whatsapp"></i> PEDIR POR WHATSAPP
                </button>
            </div>

            <div id="tab-card" class="tab-content">
                <p style="color:#ccc; font-size:0.9rem; margin-bottom:15px">Pago seguro vía PayPal (Crédito/Débito).</p>
                <div id="paypal-button-container"></div>
            </div>

            <div id="tab-bank" class="tab-content">
                <div style="background:#222; padding:15px; border:1px solid #444; font-family:monospace; color:#ddd; font-size:0.95rem;">
                    BANCO: NU<br>
                    TITULAR: CASILA MONTEKING<br>
                    TARJETA: 5101 2537 8184 6961<br>
                    <br>
                    <small style="color:var(--theme-primary)">*Mandar comprobante al: 8180106247</small>
                </div>
                <button class="pay-btn pay-wa" style="margin-top:10px" onclick="sendWhatsAppProof()">
                    ENVIAR COMPROBANTE
                </button>
            </div>
        </div>
    </div>
</div>

<footer>
    <canvas id="viz-canvas"></canvas>
    <div class="player-info">
        <span class="current-title" id="p-title">Selecciona un Beat</span>
        <span class="current-artist" id="p-artist">Monteking MX</span>
    </div>
    <div class="player-controls">
        <div class="btns">
            <i class="fas fa-step-backward amplitude-prev"></i>
            <i class="fas fa-play-circle play-main amplitude-play-pause" id="play-btn"></i>
            <i class="fas fa-step-forward amplitude-next"></i>
        </div>
        <div class="prog-bar">
            <span class="amplitude-current-time">0:00</span>
            <input type="range" class="amplitude-song-slider"/>
            <span class="amplitude-duration-time">0:00</span>
        </div>
    </div>
    <div class="player-right">
        <i class="fas fa-volume-up" style="color:var(--theme-primary)"></i>
        <input type="range" id="vol-slider" min="0" max="100" value="80" style="width:80px">
    </div>
</footer>

<script src="playlist.js"></script>

<script>
    /* 1. CORE LOGIC */
    function fixPath(p){ return p ? p.replace('ASSETS','assets').replace('Assets','assets') : ''; }
    songs.forEach((s,i)=>{
        s.cover_art_url=fixPath(s.cover_art_url);
        if(s.url && s.url.includes('TECHNO. MK')) s.url = s.url.replace('TECHNO. MK','ELECTRO MK');
        s.id=i;
    });
    
    let lastClickedIndex = 0;

    /* 2. AMPLITUDE INIT (ICON FIX) */
    Amplitude.init({
        songs: songs, volume: 80,
        callbacks: {
            play: ()=>{ 
                document.getElementById('play-btn').className='fas fa-pause-circle play-main amplitude-play-pause';
                document.querySelectorAll('.card').forEach(c=>c.classList.remove('playing'));
                const idx = Amplitude.getActiveIndex();
                const card = document.querySelector(`.card[data-index="${idx}"]`);
                if(card) card.classList.add('playing');
                initAudio();
            },
            pause: ()=>{ document.getElementById('play-btn').className='fas fa-play-circle play-main amplitude-play-pause'; },
            song_change: ()=>{
                const m=Amplitude.getActiveSongMetadata();
                document.getElementById('p-title').innerText=m.name;
                document.getElementById('p-artist').innerText=m.artist||'Monteking';
            }
        }
    });

    /* 3. RENDER GRID (RESPONSIVE) */
    const grid = document.getElementById('grid');
    function render(genre='ALL'){
        grid.innerHTML='';
        songs.forEach((s,i)=>{
            let show = (genre==='ALL') || (s.album && s.album.includes(genre)) || (genre==='TECHNO' && s.album.includes('ELECTRO'));
            if(show){
                const d = document.createElement('div');
                d.className = 'card';
                d.setAttribute('data-index', i);
                const cover = s.cover_art_url || 'assets/logo_1.png';
                d.innerHTML = `
                    <img src="${cover}" class="card-bg">
                    <div class="card-overlay">
                        <div class="card-controls">
                            <span class="card-bpm">${s.bpm || 'FREE'} BPM</span>
                            <div class="card-actions">
                                <div class="card-play-btn" onclick="playIdx(event,${i})"><i class="fas fa-play"></i></div>
                                <div class="card-add-btn" onclick="openBuy(event,${i})"><i class="fas fa-shopping-cart"></i></div>
                            </div>
                        </div>
                        <div class="card-title">${s.name}</div>
                    </div>
                `;
                d.onclick = (e) => { if(!e.target.closest('.card-actions')) openBuy(e,i); };
                // Tilt en PC
                if(window.matchMedia("(hover: hover)").matches) VanillaTilt.init(d,{max:10,speed:400,glare:true,"max-glare":0.2});
                grid.appendChild(d);
            }
        });
    }
    window.playIdx=(e,i)=>{ e.stopPropagation(); Amplitude.playSongAtIndex(i); lastClickedIndex=i; }
    window.openBuy=(e,i)=>{ e.stopPropagation(); lastClickedIndex=i; openModal(i); }

    /* 4. THEMES */
    const themes = {
        'TRAP-MEMPH': {p:'#39FF14', g:'rgba(57,255,20,0.8)', t:'rgba(0,20,0,0.7)'},
        'SUAVE': {p:'#D500F9', g:'rgba(213,0,249,0.8)', t:'rgba(20,0,20,0.7)'},
        'TECHNO': {p:'#00E5FF', g:'rgba(0,229,255,0.8)', t:'rgba(0,20,30,0.7)'},
        'ALL': {p:'#FFD700', g:'rgba(255,215,0,0.8)', t:'rgba(20,15,0,0.6)'}
    };
    function setTheme(k,btn){
        document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active'));
        if(btn) btn.classList.add('active');
        render(k);
        const t = themes[k] || themes['ALL'];
        const r = document.documentElement.style;
        r.setProperty('--theme-primary',t.p); r.setProperty('--theme-glow',t.g); r.setProperty('--theme-bg-tint',t.t);
    }

    /* 5. PAYMENTS & MODAL */
    const modal = document.getElementById('modal');
    let activeSong = null;
    
    function openModal(i){
        activeSong = songs[i];
        document.getElementById('m-img').src = activeSong.cover_art_url || 'assets/logo_1.png';
        document.getElementById('m-title').innerText = activeSong.name;
        document.getElementById('m-meta').innerText = `${activeSong.bpm} BPM | ${activeSong.album}`;
        modal.style.display = 'flex';
        renderPayPalBtn(500);
        document.getElementById('cart-btn').style.display='flex';
    }
    function closeModal(){ modal.style.display='none'; document.getElementById('paypal-button-container').innerHTML=''; }
    window.onclick=(e)=>{if(e.target==modal)closeModal()};

    window.switchTab = (id, e) => {
        document.querySelectorAll('.tab-content').forEach(c=>c.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        e.target.classList.add('active');
    }
    window.updateTotal = () => { renderPayPalBtn(document.getElementById('m-license').value); }

    function renderPayPalBtn(amount){
        const c = document.getElementById('paypal-button-container'); c.innerHTML = '';
        paypal.Buttons({
            style: { layout: 'horizontal', color: 'gold', shape: 'rect', label: 'pay', height: 40 },
            createOrder: (d,a) => a.order.create({ purchase_units: [{ amount: { value: amount } }] }),
            onApprove: (d,a) => a.order.capture().then(det => { alert('Pago Éxitoso! ' + det.payer.name.given_name); sendWhatsAppProof(); })
        }).render('#paypal-button-container');
    }

    window.sendWhatsApp = () => {
        const lic = document.getElementById('m-license');
        const licTxt = lic.options[lic.selectedIndex].text;
        const msg = `Hola Monteking, quiero comprar *${activeSong.name}* (${licTxt}).`;
        window.open(`https://wa.me/5218180106247?text=${encodeURIComponent(msg)}`, '_blank');
    }
    window.sendWhatsAppProof = () => {
        const msg = `Hola, envío comprobante de pago por el beat: *${activeSong.name}*.`;
        window.open(`https://wa.me/5218180106247?text=${encodeURIComponent(msg)}`, '_blank');
    }

    /* 6. VISUALIZER & PARTICLES (ACTIVADAS EN MOVIL) */
    let actx,anl,cnv,ctx;
    function initAudio(){
        if(actx)return;
        try{
            actx=new (window.AudioContext||window.webkitAudioContext)();
            anl=actx.createAnalyser();
            const src=actx.createMediaElementSource(Amplitude.getAudio());
            src.connect(anl); anl.connect(actx.destination);
            cnv=document.getElementById('viz-canvas'); ctx=cnv.getContext('2d');
            loopViz();
        }catch(e){}
    }
    function loopViz(){
        requestAnimationFrame(loopViz);
        cnv.width=window.innerWidth; cnv.height=130;
        const len=anl.frequencyBinCount; const data=new Uint8Array(len);
        anl.getByteFrequencyData(data);
        const w=(cnv.width/len)*2.5; let x=0;
        ctx.fillStyle=getComputedStyle(document.documentElement).getPropertyValue('--theme-primary');
        for(let i=0;i<len;i++){ const h=data[i]/2; ctx.fillRect(x,cnv.height-h,w,h); x+=w+1; }
    }
    document.body.addEventListener('click', ()=>{if(!actx)initAudio();},{once:true});

    // PARTICLES (OPTIMIZED FOR MOBILE)
    const pc=document.getElementById('particles-js');
    // Si es movil (<768px), usa 20 particulas. Si es PC, usa 50.
    const isMobile = window.innerWidth < 768;
    const pCount = isMobile ? 20 : 50; 

    function sp(){
        const p=document.createElement('div'); p.className='sparkle';
        p.style.left=Math.random()*100+'vw'; p.style.top=Math.random()*100+'vh';
        const s=Math.random()*4+1; p.style.width=s+'px'; p.style.height=s+'px';
        p.style.transition=`transform ${Math.random()*5+3}s linear, opacity 3s ease`;
        pc.appendChild(p);
        setTimeout(()=>{p.style.transform=`translate(${(Math.random()-0.5)*200}px, ${(Math.random()-0.5)*200}px)`; p.style.opacity=Math.random()},50);
        setTimeout(()=>{p.remove();sp()},4000);
    }
    for(let i=0;i<pCount;i++)setTimeout(sp,Math.random()*4000);
    
    // MOUSE TRAIL (PC ONLY)
    if(!isMobile){
        const curs=document.querySelector('.cursor');
        document.addEventListener('mousemove',e=>{
            curs.style.left=e.clientX+'px'; curs.style.top=e.clientY+'px';
            document.querySelector('.bg-texture').style.transform=`translate(${(window.innerWidth-e.clientX)/50}px, ${(window.innerHeight-e.clientY)/50}px)`;
        });
    }

    document.getElementById('vol-slider').addEventListener('input', e=>{ Amplitude.setVolume(e.target.value); });

    render('ALL');
</script>
</body>
</html>