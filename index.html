<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Catálogo Oficial | MONTEKING MX</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script async src="https://www.googletagmanager.com/gtag/js?id=G-STKXJ58C44"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-STKXJ58C44', {
      'page_title': 'Catálogo Beats Monteking',
      'send_page_view': true
  });
</script>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Oswald:wght@400;500;700&family=Pirata+One&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/amplitudejs@5.3.2/dist/amplitude.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vanilla-tilt@1.8.1/dist/vanilla-tilt.min.js"></script>

<style>
/* --- VARIABLES DINAMICAS --- */
:root {
    --theme-primary: #FFD700;
    --theme-glow: rgba(255, 215, 0, 0.6); 
    --theme-bg-tint: rgba(20, 20, 0, 0.5); 
}

/* Transiciones */
*, *::before, *::after {
    transition: color 0.5s, border-color 0.5s, background-color 0.5s, box-shadow 0.5s, text-shadow 0.5s, -webkit-text-stroke 0.5s, filter 0.5s;
}

/* --- BASICS --- */
*{margin:0;padding:0;box-sizing:border-box; cursor: none;}
body{
    background:#050505; color:#fff; font-family:'Oswald', sans-serif;
    overflow-x:hidden; padding-bottom:160px;
}

/* --- MOUSE TRAIL --- */
.cursor {
    position: fixed; top: 0; left: 0; width: 12px; height: 12px;
    background: #fff; border-radius: 50%;
    pointer-events: none; z-index: 10001;
    box-shadow: 0 0 10px #fff; transform: translate(-50%, -50%); mix-blend-mode: difference;
}
.trail-node {
    position: fixed; top: 0; left: 0;
    border-radius: 50%; pointer-events: none; z-index: 10000;
    background: var(--theme-primary);
    box-shadow: 0 0 15px var(--theme-primary); transform: translate(-50%, -50%);
}

/* --- BACKGROUND SYSTEM --- */
.bg-container { position: fixed; inset: 0; z-index: -10; pointer-events: none; overflow: hidden; }
.bg-texture {
    position: absolute; inset: -50px;
    background: url('assets/crocodile_texture.jpg') center/cover;
    opacity: 0.6; filter: brightness(0.4);
}
.bg-tint { position: absolute; inset: 0; background: var(--theme-bg-tint); mix-blend-mode: overlay; }
.bg-smoke {
    position: absolute; inset: 0;
    background: url('https://raw.githubusercontent.com/SochavaAG/example-assets/master/fog1.png') repeat-x;
    background-size: 200% 100%; opacity: 0.3; animation: smokeMove 40s linear infinite;
}
#particles-js { position: absolute; inset: 0; }
.sparkle {
    position: absolute; width: 4px; height: 4px; background: var(--theme-primary);
    border-radius: 50%; box-shadow: 0 0 8px var(--theme-primary); opacity: 0;
}
@keyframes smokeMove { 0%{background-position:0 0} 100%{background-position:-200% 0} }

/* --- HEADER --- */
header { position: relative; padding: 20px; text-align: center; perspective: 1000px; z-index: 10; }

.top-bar {
    display: flex; justify-content: space-between; align-items: center;
    padding: 0 40px; position: absolute; width: 100%; top: 20px;
}
.social-icons a { 
    color: #fff; font-size: 1.8rem; margin-right: 20px; text-decoration: none; 
    transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); display: inline-block;
}
.social-icons a:hover { 
    color: var(--theme-primary); transform: translateY(-5px) scale(1.2); 
    text-shadow: 0 0 20px var(--theme-primary); 
}
.logos-container img { height: 80px; transition: 0.3s; cursor: pointer; }
.logos-container img:hover { transform: scale(1.1); filter: drop-shadow(0 0 15px var(--theme-primary)); }

.hanging-sign {
    display: inline-block; margin-top: 100px;
    transform-origin: top center;
    animation: swing 6s ease-in-out infinite; position: relative;
}
.chain-left, .chain-right {
    position: absolute; top: -140px; width: 14px; height: 160px;
    background: repeating-linear-gradient(0deg, #8a6e0e, #ffd700 8px, #8a6e0e 16px, transparent 16px, transparent 22px);
    border-left: 1px solid #000; border-right: 1px solid #000;
    filter: drop-shadow(5px 5px 5px rgba(0,0,0,0.8)); z-index: -1;
}
.chain-left { left: 5%; transform: rotate(15deg); }
.chain-right { right: 5%; transform: rotate(-15deg); }

.main-title {
    font-family: 'Pirata One', cursive; font-size: 7rem; line-height: 0.9;
    color: transparent; -webkit-text-stroke: 2px var(--theme-primary);
    background: linear-gradient(180deg, #fff 0%, #ccc 100%);
    -webkit-background-clip: text; background-clip: text;
    filter: drop-shadow(0 0 30px var(--theme-glow));
}
.subtitle {
    font-family: 'Oswald', sans-serif; letter-spacing: 10px; font-size: 1.5rem;
    color: var(--theme-primary); text-transform: uppercase; margin-top: 15px;
    text-shadow: 0 0 10px var(--theme-glow);
}
@keyframes swing { 0% { transform: rotate(2deg); } 50% { transform: rotate(-2deg); } 100% { transform: rotate(2deg); } }

/* --- LICENCIAS --- */
#licenses {
    max-width: 950px; margin: 60px auto;
    background: rgba(0,0,0,0.7);
    border: 2px solid var(--theme-primary);
    box-shadow: 0 0 30px var(--theme-glow), inset 0 0 50px rgba(0,0,0,0.8);
    padding: 40px; text-align: left; backdrop-filter: blur(10px);
}
#licenses h2 {
    font-family: 'Pirata One', cursive; color: var(--theme-primary);
    font-size: 3.5rem; text-align: center; margin-bottom: 30px; font-weight: 400;
    text-shadow: 0 0 15px var(--theme-glow);
}
.license-item { margin-bottom: 25px; border-bottom: 1px solid #444; padding-bottom: 15px; }
.license-item .header-row { display: flex; justify-content: space-between; align-items: center; }
.license-item b { color: #fff; font-size: 1.5rem; letter-spacing: 1px; }
.price-tag {
    color: var(--theme-primary); font-size: 2.2rem; font-weight: bold; font-family: 'Pirata One'; text-shadow: none;
}
.license-item p { color: #ccc; font-weight: 300; font-size: 1.1rem; margin-top: 8px; }

/* FIRMA FILTRO DINAMICO */
.signature-img {
    display: block; width: 220px; margin: 30px auto 0;
    filter: drop-shadow(0 0 0 var(--theme-primary)); opacity: 0.9;
}

/* --- FILTROS --- */
.filters { display: flex; justify-content: center; gap: 15px; margin-bottom: 40px; flex-wrap: wrap; }
.filter-btn {
    background: rgba(0,0,0,0.8); border: 1px solid #555; color: #fff;
    font-family: 'Oswald', sans-serif; font-size: 1.2rem;
    padding: 12px 30px; cursor: pointer; text-transform: uppercase; transition: 0.4s;
}
.filter-btn:hover, .filter-btn.active {
    background: var(--theme-primary); color: #000;
    box-shadow: 0 0 25px var(--theme-glow); font-weight: bold; border-color: var(--theme-primary);
}

/* --- GRID --- */
.grid {
    display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
    gap: 30px; padding: 0 40px; max-width: 1400px; margin: 0 auto;
}
.card {
    position: relative; height: 380px; background: #000; border: 1px solid #333;
    overflow: hidden; cursor: pointer; transition: 0.3s;
}
.card:hover {
    border-color: var(--theme-primary); box-shadow: 0 10px 40px var(--theme-glow); transform: translateY(-5px);
}
.card-bg {
    width: 100%; height: 100%; background-size: cover; background-position: center;
    transition: transform 0.6s; opacity: 0.7;
}
.card:hover .card-bg { transform: scale(1.1); opacity: 0.4; }
.card-info {
    position: absolute; bottom: 0; left: 0; width: 100%; padding: 20px;
    background: linear-gradient(to top, #000 30%, transparent);
}
.card-title {
    font-family: 'Pirata One', cursive; font-size: 2rem;
    color: transparent; -webkit-text-stroke: 1px var(--theme-primary);
    filter: drop-shadow(0 0 3px #000);
}
.card-meta { font-size: 1rem; color: var(--theme-primary); display: flex; justify-content: space-between; align-items: center; }
.card-play-btn {
    width: 45px; height: 45px; border-radius: 50%; border: 2px solid var(--theme-primary);
    display: flex; align-items: center; justify-content: center;
    color: var(--theme-primary); transition: 0.2s; font-size: 1.2rem; background: rgba(0,0,0,0.5);
}
.card-play-btn:hover { background: var(--theme-primary); color: #000; box-shadow: 0 0 15px var(--theme-primary); }

/* --- MODAL --- */
.modal-overlay {
    display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 5000;
    justify-content: center; align-items: center; backdrop-filter: blur(15px);
}
.modal-content {
    background: #000; border: 2px solid var(--theme-primary); width: 90%; max-width: 900px;
    padding: 30px; display: flex; gap: 30px; position: relative; box-shadow: 0 0 60px var(--theme-glow);
}
.modal-img { width: 350px; height: 350px; object-fit: cover; border: 1px solid #333; box-shadow: 10px 10px 0 #111; }
.modal-details { flex: 1; display: flex; flex-direction: column; justify-content: center; }
.close-modal { position: absolute; top: 15px; right: 25px; color: #fff; font-size: 2.5rem; cursor: pointer; transition:0.3s; }
.close-modal:hover { color: var(--theme-primary); text-shadow: 0 0 10px var(--theme-primary); }

.add-btn {
    width: 100%; padding: 15px; margin-top: 10px;
    background: var(--theme-primary); border: none; font-weight: bold; font-size: 1.2rem;
    cursor: pointer; text-transform: uppercase; font-family: 'Oswald'; transition: 0.3s;
}
.add-btn:hover { box-shadow: 0 0 25px var(--theme-glow); transform: scale(1.02); }
.wa-btn-modal { background: #25D366; color: #fff; margin-top: 10px; }
.wa-btn-modal:hover { box-shadow: 0 0 20px #25D366; }

/* --- CART --- */
.cart-widget {
    position: fixed; bottom: 180px; right: 20px; background: #000;
    border: 2px solid var(--theme-primary); padding: 20px; width: 320px;
    display: none; z-index: 4000; box-shadow: 0 0 30px var(--theme-glow);
}

/* --- PLAYER --- */
footer {
    position: fixed; bottom: 0; left: 0; width: 100%; height: 130px;
    background: #000; border-top: 3px solid var(--theme-primary); padding: 10px 30px;
    display: grid; grid-template-columns: 1fr 2fr 1fr; align-items: center; z-index: 2000;
    box-shadow: 0 -10px 60px rgba(0,0,0,1);
}
#viz-canvas { position: absolute; bottom: 0; left: 0; width: 100%; height: 100%; z-index: -1; opacity: 0.4; pointer-events: none; }
.player-info { z-index: 2; }
.current-song-title { font-family: 'Pirata One'; font-size: 1.6rem; color: var(--theme-primary); display: block; text-shadow: 0 0 10px var(--theme-glow); }
.controls { display: flex; align-items: center; gap: 30px; margin-bottom: 5px; justify-content: center; }
.ctrl-btn { background: none; border: none; color: #fff; font-size: 1.8rem; cursor: pointer; }
.ctrl-btn:hover { color: var(--theme-primary); text-shadow: 0 0 15px var(--theme-primary); transform: scale(1.1); }
.play-big { font-size: 3rem; }

/* SLIDERS */
.progress-container { width: 100%; display: flex; align-items: center; gap: 10px; font-family: monospace; color: var(--theme-primary); }
input[type=range] { width: 100%; -webkit-appearance: none; background: transparent; cursor: pointer; }
input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 6px; background: #333; border-radius: 3px; }
input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 16px; width: 16px; border-radius: 50%; background: var(--theme-primary); margin-top: -5px; box-shadow: 0 0 10px var(--theme-glow); transition: transform 0.1s; }
input[type=range]::-webkit-slider-thumb:hover { transform: scale(1.3); }

.player-right { text-align: right; z-index: 2; display:flex; justify-content: flex-end; align-items: center; gap: 10px; }

@media(max-width: 768px) {
    .main-title { font-size: 4rem; }
    footer { display: flex; flex-direction: column; height: auto; padding: 20px; gap: 15px; }
    .modal-content { flex-direction: column; }
    .modal-img { width: 100%; height: 250px; }
    .logos-container { display: flex; gap: 10px; }
}
</style>
</head>
<body>

<div class="bg-container">
    <div class="bg-texture" id="bg-texture"></div>
    <div class="bg-tint"></div>
    <div class="bg-smoke"></div>
    <div id="particles-js"></div>
</div>
<div class="cursor"></div>

<header>
    <div class="top-bar">
        <div class="social-icons">
            <a href="https://instagram.com/casilaog" target="_blank" onclick="trackClick('Instagram')"><i class="fab fa-instagram"></i></a>
            <a href="https://youtube.com/@montekingmx" target="_blank" onclick="trackClick('YouTube')"><i class="fab fa-youtube"></i></a>
            <a href="https://facebook.com/casillasg" target="_blank" onclick="trackClick('Facebook')"><i class="fab fa-facebook"></i></a>
        </div>
        <div class="logos-container">
            <a href="https://youtube.com/@montekingmx" target="_blank"><img src="assets/logo_1.png"></a>
            <a href="https://youtube.com/@montekingmx" target="_blank"><img src="assets/logo_2.png"></a>
        </div>
    </div>
    <div class="hanging-sign">
        <div class="chain-left"></div>
        <div class="chain-right"></div>
        <h1 class="main-title">MONTEKING MX</h1>
        <div class="subtitle">Catálogo de Beats Premium</div>
    </div>
</header>

<section id="licenses">
    <h2>LICENCIAS & PRECIOS</h2>
    <div class="license-item">
        <div class="header-row">
            <b>1. Licencia Estándar (WAV)</b>
            <span class="price-tag">$500 MXN</span>
        </div>
        <p>Recibes WAV Masterizado. Derechos comerciales no exclusivos. El beat sigue en venta.</p>
    </div>
    <div class="license-item">
        <div class="header-row">
            <b>2. Licencia Pro (Trackout + WAV)</b>
            <span class="price-tag">$700 MXN</span>
        </div>
        <p>STEMS (Pistas separadas) + WAV + MP3. Derechos comerciales. Ideal mezcla profesional.</p>
    </div>
    <div class="license-item">
        <div class="header-row">
            <b>3. Licencia Exclusiva</b>
            <span class="price-tag">$1000 MXN*</span>
        </div>
        <p>Todo lo anterior. Archivos completos. El beat se elimina del catálogo y es completamente tuyo. *O opción de precio con descuento + % de regalías.</p>
    </div>
    <img src="assets/signature.png" class="signature-img" alt="Represent.">
</section>

<div class="filters">
    <button class="filter-btn active" onclick="setTheme('ALL', this)">ALL BEATS</button>
    <button class="filter-btn" onclick="setTheme('TRAP-MEMPH', this)">TRAP MEMPHIS</button>
    <button class="filter-btn" onclick="setTheme('BOOMBAP', this)">BOOMBAP CLASSIC</button>
    <button class="filter-btn" onclick="setTheme('TECHNO', this)">TECHNO / ELECTRO</button>
    <button class="filter-btn" onclick="setTheme('SUAVE', this)">SUAVE / R&B</button>
</div>

<div class="grid" id="grid"></div>

<div class="modal-overlay" id="modal">
    <div class="modal-content">
        <span class="close-modal" onclick="closeModal()">&times;</span>
        <img src="" class="modal-img" id="m-img">
        <div class="modal-details">
            <h2 style="font-family:'Pirata One'; color:var(--theme-primary); font-size:3rem;" id="m-title">Title</h2>
            <p id="m-meta" style="color:#aaa; font-size:1.2rem; margin-bottom:20px;">Info</p>
            <label>Elige tu Licencia:</label>
            <select id="m-license" style="width:100%; padding:15px; margin-bottom:10px; background:#222; color:#fff; border:1px solid #555; font-size:1.1rem;">
                <option value="Estándar ($500)">Licencia Estándar - $500 MXN</option>
                <option value="Pro ($700)">Licencia Pro (Stems) - $700 MXN</option>
                <option value="Exclusiva ($1000/Trato)">Licencia Exclusiva - $1000/Trato</option>
            </select>
            <button class="add-btn" onclick="addToCartCurrent()">Añadir al Pedido</button>
            <button class="add-btn wa-btn-modal" onclick="sendDirectMessage()"><i class="fab fa-whatsapp"></i> Preguntar solo por este</button>
        </div>
    </div>
</div>

<div class="cart-widget" id="cart-widget">
    <div style="display:flex; justify-content:space-between; border-bottom:1px solid #444; margin-bottom:10px;">
        <span style="font-family:'Pirata One'; font-size:1.4rem; color:var(--theme-primary)">TU CARRITO</span>
        <i class="fas fa-trash" style="cursor:pointer" onclick="clearCart()"></i>
    </div>
    <div id="cart-items" style="max-height:150px; overflow-y:auto; margin-bottom:10px;"></div>
    <a id="wa-checkout" href="#" target="_blank" class="add-btn wa-btn-modal" style="display:block; text-align:center; text-decoration:none;">ENVIAR PEDIDO</a>
</div>

<footer>
    <canvas id="viz-canvas"></canvas>
    <div class="player-info">
        <span class="current-song-title" id="footer-title">Selecciona un Beat</span>
        <span class="current-artist" id="footer-artist">Monteking MX</span>
    </div>
    <div class="player-center">
        <div class="controls">
            <button class="ctrl-btn amplitude-prev"><i class="fas fa-step-backward"></i></button>
            <button class="ctrl-btn play-big amplitude-play-pause" id="main-play"><i class="fas fa-play"></i></button>
            <button class="ctrl-btn amplitude-next"><i class="fas fa-step-forward"></i></button>
        </div>
        <div class="progress-container">
            <span class="amplitude-current-time">00:00</span>
            <input type="range" class="amplitude-song-slider"/>
            <span class="amplitude-duration-time">00:00</span>
        </div>
    </div>
    <div class="player-right">
        <i class="fas fa-volume-up" style="color:var(--theme-primary)"></i>
        <input type="range" id="vol-slider" min="0" max="100" value="80" style="width:100px; accent-color:var(--theme-primary)"/>
    </div>
</footer>

<script src="playlist.js"></script>

<script>
    /* 1. ANALYTICS HELPER */
    function trackClick(name) {
        if(typeof gtag === 'function') {
            gtag('event', 'click', { 'event_category': 'Social', 'event_label': name });
        }
    }

    /* 2. SYSTEM FIXES */
    function fixPath(path) {
        if(!path) return '';
        return path.replace('ASSETS', 'assets').replace('Assets', 'assets');
    }
    songs.forEach((s, i) => {
        s.cover_art_url = fixPath(s.cover_art_url);
        if(s.url && s.url.includes('TECHNO. MK')) s.url = s.url.replace('TECHNO. MK', 'ELECTRO MK');
        s.id = i;
    });

    /* 3. PLAYER INIT */
    Amplitude.init({
        songs: songs,
        volume: 80,
        callbacks: {
            play: function(){ document.getElementById('main-play').innerHTML = '<i class="fas fa-pause"></i>'; initAudioContext(); },
            pause: function(){ document.getElementById('main-play').innerHTML = '<i class="fas fa-play"></i>'; },
            song_change: function(){
                const song = Amplitude.getActiveSongMetadata();
                document.getElementById('footer-title').innerText = song.name;
                document.getElementById('footer-artist').innerText = song.artist || 'Monteking MX';
            }
        }
    });

    /* 4. VOLUME CONTROL (HARDWARE DIRECT) */
    const volSlider = document.getElementById('vol-slider');
    volSlider.addEventListener('input', (e) => {
        const val = parseInt(e.target.value);
        Amplitude.setVolume(val);
        const audio = Amplitude.getAudio();
        if(audio) audio.volume = val / 100;
    });

    /* 5. THEME ENGINE */
    const themes = {
        'TRAP-MEMPH': { primary: '#39FF14', glow: 'rgba(57, 255, 20, 0.8)', tint: 'rgba(0, 20, 0, 0.7)' },
        'SUAVE': { primary: '#D500F9', glow: 'rgba(213, 0, 249, 0.8)', tint: 'rgba(20, 0, 20, 0.7)' },
        'TECHNO': { primary: '#00E5FF', glow: 'rgba(0, 229, 255, 0.8)', tint: 'rgba(0, 20, 30, 0.7)' },
        'BOOMBAP': { primary: '#FFD700', glow: 'rgba(255, 215, 0, 0.8)', tint: 'rgba(20, 15, 0, 0.6)' },
        'ALL': { primary: '#FFD700', glow: 'rgba(255, 215, 0, 0.8)', tint: 'rgba(20, 15, 0, 0.6)' }
    };
    function setTheme(genreKey, btnElement) {
        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
        if(btnElement) btnElement.classList.add('active');
        renderGrid(genreKey);
        let theme = themes['ALL'];
        if(themes[genreKey]) theme = themes[genreKey];
        else if(genreKey === 'TECHNO') theme = themes['TECHNO'];
        const root = document.documentElement;
        root.style.setProperty('--theme-primary', theme.primary);
        root.style.setProperty('--theme-glow', theme.glow);
        root.style.setProperty('--theme-bg-tint', theme.tint);
    }

    /* 6. GRID RENDER */
    const grid = document.getElementById('grid');
    function renderGrid(genre = 'ALL') {
        grid.innerHTML = '';
        songs.forEach((s, index) => {
            let match = false;
            if(genre === 'ALL') match = true;
            else if(s.album && s.album.includes(genre)) match = true;
            else if(genre === 'TECHNO' && (s.album.includes('TECHNO') || s.album.includes('ELECTRO'))) match = true;

            if(match) {
                const card = document.createElement('div');
                card.className = 'card';
                const cover = s.cover_art_url || 'assets/logo_1.png';
                card.innerHTML = `
                    <div class="card-bg" style="background-image: url('${cover}')"></div>
                    <div class="card-info">
                        <div class="card-title">${s.name}</div>
                        <div class="card-meta">
                            <span>${s.bpm || 'FREE'} BPM</span>
                            <div class="card-play-btn" onclick="playPreview(event, ${index})"><i class="fas fa-play"></i></div>
                        </div>
                    </div>
                `;
                card.onclick = (e) => { if(!e.target.closest('.card-play-btn')) openModal(index); };
                VanillaTilt.init(card, {max:10, speed:400, glare:true, "max-glare":0.2});
                grid.appendChild(card);
            }
        });
    }
    window.playPreview = (e, i) => { e.stopPropagation(); Amplitude.playSongAtIndex(i); };

    /* 7. VISUALIZER & PARTICLES & TRAIL */
    let audioCtx, analyser, canvas, ctx;
    function initAudioContext() {
        if(audioCtx) return;
        try {
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            analyser = audioCtx.createAnalyser();
            const audio = Amplitude.getAudio();
            audio.crossOrigin = "anonymous";
            const src = audioCtx.createMediaElementSource(audio);
            src.connect(analyser);
            analyser.connect(audioCtx.destination);
            canvas = document.getElementById('viz-canvas'); ctx = canvas.getContext('2d');
            animateViz();
        } catch(e) {}
    }
    function animateViz() {
        requestAnimationFrame(animateViz);
        canvas.width = window.innerWidth; canvas.height = 130;
        const bufferLength = analyser.frequencyBinCount;
        const dataArray = new Uint8Array(bufferLength);
        analyser.getByteFrequencyData(dataArray);
        const barWidth = (canvas.width / bufferLength) * 2.5;
        let x = 0;
        for(let i = 0; i < bufferLength; i++) {
            const barHeight = dataArray[i] / 2;
            ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--theme-primary');
            ctx.fillRect(x, canvas.height - barHeight, barWidth, barHeight);
            x += barWidth + 1;
        }
    }
    document.body.addEventListener('click', () => { if(!audioCtx) initAudioContext(); }, {once:true});

    // Trail
    const cursor = document.querySelector('.cursor');
    const trailNodes = []; const trailSize = 20;
    for(let i=0; i<trailSize; i++) {
        const node = document.createElement('div'); node.className = 'trail-node';
        document.body.appendChild(node); trailNodes.push({ el: node, x: 0, y: 0 });
    }
    let mouseX = 0, mouseY = 0;
    document.addEventListener('mousemove', e => {
        mouseX = e.clientX; mouseY = e.clientY;
        cursor.style.left = mouseX + 'px'; cursor.style.top = mouseY + 'px';
        const px = (window.innerWidth - mouseX) / 40;
        const py = (window.innerHeight - mouseY) / 40;
        document.getElementById('bg-texture').style.transform = `translate(${px}px, ${py}px)`;
    });
    function animateTrail() {
        let x = mouseX; let y = mouseY;
        trailNodes.forEach((node, index) => {
            node.x += (x - node.x) * 0.3; node.y += (y - node.y) * 0.3;
            node.el.style.left = node.x + 'px'; node.el.style.top = node.y + 'px';
            const size = (trailSize - index) * 0.8;
            node.el.style.width = size + 'px'; node.el.style.height = size + 'px';
            node.el.style.opacity = (trailSize - index) / trailSize * 0.5;
            x = node.x; y = node.y;
        });
        requestAnimationFrame(animateTrail);
    }
    animateTrail();

    // Particles
    const particleContainer = document.getElementById('particles-js');
    function createParticle() {
        const p = document.createElement('div'); p.classList.add('sparkle');
        p.style.left = Math.random() * 100 + 'vw'; p.style.top = Math.random() * 100 + 'vh';
        const size = Math.random() * 4 + 1;
        p.style.width = size + 'px'; p.style.height = size + 'px';
        p.style.transition = `transform ${Math.random()*4+2}s linear, opacity ${Math.random()*3+1}s ease-in-out`;
        particleContainer.appendChild(p);
        setTimeout(() => {
            const destX = (Math.random() - 0.5) * 300; const destY = (Math.random() - 0.5) * 300;
            p.style.transform = `translate(${destX}px, ${destY}px)`; p.style.opacity = Math.random();
        }, 50);
        setTimeout(() => { p.remove(); createParticle(); }, 4000);
    }
    for(let i=0; i<100; i++) setTimeout(createParticle, Math.random() * 4000);

    /* 8. SHOPPING CART LOGIC WITH ANALYTICS */
    let currentModalIndex = 0;
    const modal = document.getElementById('modal');
    let cart = [];
    function openModal(i) {
        currentModalIndex = i;
        const s = songs[i];
        document.getElementById('m-img').src = s.cover_art_url || 'assets/logo_1.png';
        document.getElementById('m-title').innerText = s.name;
        document.getElementById('m-meta').innerText = `${s.bpm} BPM | ${s.album}`;
        modal.style.display = 'flex';
        // GA4 View Item
        if(typeof gtag === 'function') gtag('event', 'view_item', { items: [{ item_name: s.name, item_category: s.album }]});
    }
    function closeModal() { modal.style.display = 'none'; }
    window.onclick = (e) => { if(e.target == modal) closeModal(); }

    function addToCartCurrent() {
        const s = songs[currentModalIndex];
        const lic = document.getElementById('m-license').value;
        cart.push({name:s.name, lic:lic});
        updateCart();
        closeModal();
        // GA4 Add to Cart
        if(typeof gtag === 'function') gtag('event', 'add_to_cart', { items: [{ item_name: s.name, item_variant: lic }]});
    }
    function updateCart() {
        const widget = document.getElementById('cart-widget');
        const list = document.getElementById('cart-items');
        widget.style.display = cart.length ? 'block' : 'none';
        list.innerHTML = '';
        let msg = "Hola Monteking, quiero comprar:%0A";
        cart.forEach((c, i) => {
            list.innerHTML += `<div>${c.name} <small style="color:var(--theme-primary)">(${c.lic})</small></div>`;
            msg += `${i+1}. ${c.name} (${c.lic})%0A`;
        });
        
        // Attach event to link
        const link = document.getElementById('wa-checkout');
        link.href = `https://wa.me/5218180106247?text=${msg}`;
        link.onclick = () => {
             if(typeof gtag === 'function') gtag('event', 'begin_checkout', { items: cart.map(c => ({ item_name: c.name, item_variant: c.lic })) });
        };
    }
    function clearCart() { cart=[]; updateCart(); }
    function sendDirectMessage() {
        const s = songs[currentModalIndex];
        if(typeof gtag === 'function') gtag('event', 'generate_lead', { item_name: s.name });
        window.open(`https://wa.me/5218180106247?text=Me interesa el beat: ${s.name}`, '_blank');
    }

    renderGrid('ALL');
</script>
</body>
</html>